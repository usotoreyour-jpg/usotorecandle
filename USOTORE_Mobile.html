<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>USOTORE Mobile Candle</title>
<style>
    body {
        margin: 0;
        background: #0d1117;
        color: white;
        font-family: sans-serif;
    }

    #chartContainer {
        width: 100vw;
        height: 50vh;
    }

    canvas {
        width: 100% !important;
        height: 100% !important;
    }

    .panel {
        padding: 14px;
        background: #111;
        border-top: 1px solid #222;
    }

    select, input {
        width: 100%;
        padding: 8px;
        background: #222;
        color: #fff;
        border: 1px solid #444;
        margin-bottom: 10px;
        border-radius: 4px;
    }

    .btn-container {
        display: flex;
        gap: 8px;
    }

    .btn {
        flex: 1;
        text-align: center;
        padding: 14px;
        font-weight: bold;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-high { background: #0dbf39; }
    .btn-low  { background: #c42232; }

    .balance-box {
        padding: 8px 0;
        font-size: 16px;
    }

    /* ▼ 追加修正（ラインが出ない問題を解決） */
    .entry-line-high {
        border-top: 2px solid #00ff00 !important;
    }
    .entry-line-low {
        border-top: 2px solid #ff0044 !important;
    }
</style>
</head>
<body>

<div id="chartContainer">
    <canvas id="chart"></canvas>
</div>

<div class="panel">
    <label>判定時間</label>
    <select id="duration">
        <option value="30">30秒</option>
        <option value="60">60秒</option>
        <option value="120">120秒</option>
    </select>

    <label>賭け金</label>
    <input id="amount" type="number" value="1000"/>

    <label>ペイアウト</label>
    <input id="payout" type="number" value="1.8"/>

    <div class="btn-container">
        <div class="btn btn-high" onclick="placeOrder('HIGH')">HIGH</div>
        <div class="btn btn-low" onclick="placeOrder('LOW')">LOW</div>
    </div>

    <div class="balance-box">残高：<span id="balance">¥1,000,000</span></div>
    <div id="log" style="font-size:14px;"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let balance = 1000000;
let chart;
let entryLines = [];

document.addEventListener("DOMContentLoaded", () => {
    const ctx = document.getElementById("chart").getContext("2d");
    chart = new Chart(ctx, {
        type: "candlestick",
        data: {
            datasets: [{
                label: "USOTORE",
                data: generateFakeData()
            }]
        },
        options: {
            plugins: { legend: { display: false }},
            scales: {
                x: { display: false },
                y: { display: false }
            }
        }
    });
});

function generateFakeData() {
    let data = [];
    let value = 143.300;
    for (let i = 0; i < 60; i++) {
        let open = value + (Math.random() - 0.5) * 0.05;
        let close = open + (Math.random() - 0.5) * 0.05;
        let high = Math.max(open, close) + Math.random() * 0.02;
        let low = Math.min(open, close) - Math.random() * 0.02;
        value = close;
        data.push({ o: open, h: high, l: low, c: close });
    }
    return data;
}

function placeOrder(direction) {
    const dataset = chart.data.datasets[0].data;
    const latest = dataset[dataset.length - 1].c; // 終値
    const entryY = chart.scales.y.getPixelForValue(latest);

    addEntryLine(entryY, direction);

    log(`【${direction}】 ${latest.toFixed(3)}`);
}

function addEntryLine(y, direction) {
    const line = document.createElement("div");
    line.style.position = "absolute";
    line.style.top = `${y}px`;
    line.style.left = "0px";
    line.style.width = "100%";
    line.style.pointerEvents = "none";

    if (direction === "HIGH") {
        line.classList.add("entry-line-high");
    } else {
        line.classList.add("entry-line-low");
    }

    document.body.appendChild(line);
    entryLines.push(line);
}

function log(text) {
    const logbox = document.getElementById("log");
    logbox.innerHTML = text + "<br>" + logbox.innerHTML;
}
</script>

</body>
</html>
